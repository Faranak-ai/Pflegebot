<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Pflege-Bot Schwester Lisa (B1) â€“ vollstÃ¤ndig</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    :root { --bg:#fdfdfd; --card:#ffffff; --bot:#7c2d12; --user:#14532d; }
    body { font-family: system-ui, Arial, sans-serif; background: var(--bg); margin:0; padding: 2rem 1rem; }
    .wrap { max-width: 760px; margin: 0 auto; }
    .title { text-align:center; margin-bottom: 1rem; }
    .chatbox { background: var(--card); border-radius: 12px; padding: 1rem; box-shadow: 0 6px 20px rgba(0,0,0,.08); min-height: 320px; max-height: 60vh; overflow: auto; }
    .message { margin: .75rem 0; line-height: 1.45; }
    .bot { color: var(--bot); font-weight: 600; }
    .user { color: var(--user); }
    .bar { display:flex; gap:.5rem; margin-top: .75rem; flex-wrap: wrap; }
    input[type=text] { flex:1; min-width: 240px; padding:.75rem .9rem; border-radius: 10px; border: 1px solid #cbd5e1; }
    button { padding:.6rem .9rem; border-radius:10px; border:0; background:#7c3aed; color:white; font-weight:600; cursor:pointer; }
    button.secondary { background:#475569; }
    button:hover { filter: brightness(.95); }
    .toolbar, .controls, .glossary { display:flex; gap:.5rem; justify-content:center; flex-wrap: wrap; margin-top:.75rem; }
    .note { font-size:.85rem; color:#475569; text-align:center; margin-bottom:.5rem; }
    .controls button { background:#64748b; }
    .glossary button { background:#334155; font-size:.85rem; }
  </style>
</head>
<body>
<div class="wrap">
  <div class="title">
    <h2>ğŸ‘©â€âš•ï¸ Pflegeâ€‘Bot â€Schwester Lisaâ€œ â€“ Ãœbergabe (B1)</h2>
    <div class="note">Nutzen Sie Eingabe, Sprache oder Buttons.</div>
  </div>

  <div class="toolbar">
    <button id="btnSpeakLast" class="secondary">ğŸ”Š Vorlesen</button>
    <button id="btnAutoSpeak" class="secondary">ğŸ”Š Autoâ€‘Vorlesen: AUS</button>
    <button id="btnMic" class="secondary">ğŸ™ï¸ Spracheingabe: START</button>
  </div>

  <div class="chatbox" id="chat"></div>
  <div class="bar">
    <input id="input" type="text" placeholder="Ihre Nachricht â€¦ (z.â€¯B. â€langsamâ€œ oder â€was bedeutet Dialyse?â€œ)" />
    <button id="send">Senden</button>
  </div>

  <div class="controls">
    <button onclick="nextPatient()">â¡ï¸ Weiter</button>
    <button onclick="prevPatient()">â¬…ï¸ ZurÃ¼ck</button>
    <button onclick="speakSlow()">ğŸ¢ Langsam</button>
    <button onclick="addMessage(lastBot,'bot')">ğŸ” Wiederholen</button>
    <button onclick="help()">â„¹ï¸ Hilfe</button>
  </div>

  <div class="glossary">
    <button onclick="explain('Pneumonie')">Pneumonie</button>
    <button onclick="explain('Diabetes')">Diabetes</button>
    <button onclick="explain('Hemiparese')">Hemiparese</button>
    <button onclick="explain('Dialyse')">Dialyse</button>
    <button onclick="explain('Dekubitus')">Dekubitus</button>
  </div>
</div>

<script>
// --- Patientendaten (5 FÃ¤lle) ---
const patients = [
  {
    room: "201",
    name: "Frau Novak",
    fast: "Frau Novak mit Pneumonie, Tag 2 der Antibiotikatherapie. Atemtraining und Inhalationen. SpOâ‚‚-Ziel 92â€“96â€¯% mit Sauerstoff 2â€¯L/min.",
    slow: "Frau Novak hat eine LungenentzÃ¼ndung und erhÃ¤lt seit zwei Tagen Antibiotika. Bitte fÃ¼hren Sie Atemtraining und Inhalationen durch. Wenn nÃ¶tig, geben Sie Sauerstoff Ã¼ber die Nasenbrille mit zwei Litern pro Minute. Ziel ist eine SauerstoffsÃ¤ttigung zwischen 92 und 96â€¯%.",
  },
  {
    room: "202",
    name: "Herr Meier",
    fast: "Herr Meier mit Diabetes mellitus Typ 2. Insulin nach Plan, Blutzuckerkontrollen vor den Mahlzeiten.",
    slow: "Herr Meier hat Diabetes Typ 2. Er bekommt Insulin, das nach Plan gespritzt werden muss. Messen Sie bitte seinen Blutzucker vor den Mahlzeiten und geben Sie das Insulin nach Plan. Auch die ErnÃ¤hrung ist wichtig: keine zuckerreichen Speisen.",
  },
  {
    room: "203",
    name: "Frau Ibrahim",
    fast: "Frau Ibrahim nach Schlaganfall mit Hemiparese links. Physiotherapie, LogopÃ¤die. Lagerung rechts, Aspirationsprophylaxe.",
    slow: "Frau Ibrahim hatte einen Schlaganfall. Die linke KÃ¶rperhÃ¤lfte ist gelÃ¤hmt. Deshalb muss sie Ã¼berwiegend auf die rechte Seite gelagert werden. Achten Sie darauf, dass sie sich nicht verschluckt, also Aspirationsprophylaxe. ZusÃ¤tzlich hat sie Physiotherapie und SprachÃ¼bungen bei der LogopÃ¤din.",
  },
  {
    room: "204",
    name: "Herr Schuster",
    fast: "Herr Schuster mit chronischer Niereninsuffizienz, Dialyse Mo/Mi/Fr. FlÃ¼ssigkeitsbilanz streng, Gewichtskontrolle, Shunt-Arm schonen.",
    slow: "Herr Schuster hat eine chronische NierenschwÃ¤che. Er geht montags, mittwochs und freitags zur HÃ¤modialyse. Bitte fÃ¼hren Sie eine strenge FlÃ¼ssigkeitsbilanz, wiegen Sie ihn tÃ¤glich und schonen Sie unbedingt seinen Shunt-Arm â€“ keine Blutdruckmessung, keine Blutabnahme dort.",
  },
  {
    room: "205",
    name: "Frau Petrova",
    fast: "Frau Petrova mit Dekubitus Stadium II im Sakralbereich. Wundversorgung nach Plan, Umlagerung alle 2 Stunden, ErnÃ¤hrung beachten.",
    slow: "Frau Petrova hat ein DruckgeschwÃ¼r am Kreuzbein, Stadium II. Sie bekommt Wundversorgung nach Verbandplan. Bitte lagern Sie sie alle zwei Stunden um und achten Sie auf eine eiweiÃŸreiche ErnÃ¤hrung, damit die Heilung gefÃ¶rdert wird.",
  },
];

// --- Glossar ---
const glossary = {
  "pneumonie": "Pneumonie bedeutet LungenentzÃ¼ndung, meist durch Bakterien oder Viren. Typische Symptome: Husten, Fieber, Atemnot.",
  "diabetes": "Diabetes mellitus Typ 2 ist eine chronische Stoffwechselkrankheit. Der Blutzuckerspiegel ist zu hoch, oft ist Insulintherapie nÃ¶tig.",
  "hemiparese": "Hemiparese ist eine HalbseitenlÃ¤hmung, hÃ¤ufig nach Schlaganfall.",
  "dialyse": "Dialyse ist ein Blutreinigungsverfahren, das bei schwerer NierenschwÃ¤che durchgefÃ¼hrt wird.",
  "dekubitus": "Dekubitus ist ein DruckgeschwÃ¼r durch langes Liegen. Es wird nach Stadien eingeteilt und muss regelmÃ¤ÃŸig versorgt werden."
};

// --- Chat-Logik & Sprache ---
const chat = document.getElementById('chat');
const input = document.getElementById('input');
const sendBtn = document.getElementById('send');
const btnSpeakLast = document.getElementById('btnSpeakLast');
const btnAutoSpeak = document.getElementById('btnAutoSpeak');
const btnMic = document.getElementById('btnMic');

let current = 0;
let lastBot = "";
let autoSpeak = false;

function addMessage(text, sender='bot') {
  const div = document.createElement('div');
  div.className = 'message ' + sender;
  div.textContent = (sender === 'bot' ? 'ğŸ‘©â€âš•ï¸ Schwester Lisa: ' : 'ğŸ‘¤ ') + text;
  chat.appendChild(div);
  chat.scrollTop = chat.scrollHeight;
  if (sender === 'bot') {
    lastBot = text;
    if (autoSpeak) speak(text);
  }
}

// TTS
function speak(text) {
  try {
    window.speechSynthesis.cancel();
    const u = new SpeechSynthesisUtterance(text);
    u.lang = 'de-DE';
    u.rate = 0.98;
    window.speechSynthesis.speak(u);
  } catch (e) { console.error(e); }
}

// STT
let recognition = null, recognizing = false;
function initSTT(){
  const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
  if (!SR) return null;
  const rec = new SR();
  rec.lang = 'de-DE';
  rec.onresult = (e)=>{ const t=e.results[0][0].transcript; addMessage(t,'user'); routeInput(t); };
  rec.onend = ()=>{ recognizing=false; btnMic.textContent='ğŸ™ï¸ Spracheingabe: START'; };
  return rec;
}
function toggleSTT(){
  if (!recognition) recognition = initSTT();
  if (!recognition) { alert('Spracheingabe wird von diesem Browser nicht unterstÃ¼tzt. Bitte Chrome verwenden.'); return; }
  if (recognizing) { recognition.stop(); recognizing=false; btnMic.textContent='ğŸ™ï¸ Spracheingabe: START'; }
  else { recognition.start(); recognizing=true; btnMic.textContent='ğŸ›‘ Spracheingabe: STOP'; }
}

// Routing
function intro(){ addMessage("Guten Morgen! Ich bin Schwester Lisa. Ich beginne mit der Ãœbergabe. Nutzen Sie Eingabe oder Buttons."); speakFast(); }
function speakFast(){ const p=patients[current]; addMessage(`Zimmer ${p.room} â€“ ${p.name}: ${p.fast}`); }
function speakSlow(){ const p=patients[current]; addMessage(`Ich wiederhole langsamer: Zimmer ${p.room} â€“ ${p.name}. ${p.slow}`); }
function prevPatient(){ current=(current-1+patients.length)%patients.length; speakFast(); }
function nextPatient(){ current=(current+1)%patients.length; speakFast(); }
function explain(term){
  const key = (term||'').toLowerCase().normalize('NFD').replace(/[^\wÃ¤Ã¶Ã¼ÃŸ]/g,'');
  let found = null;
  for (const k in glossary) {
    const norm = k.toLowerCase().normalize('NFD').replace(/[^\wÃ¤Ã¶Ã¼ÃŸ]/g,'');
    if (key.includes(norm) || norm.includes(key)) { found = k; break; }
  }
  if (found) addMessage(`${found[0].toUpperCase()+found.slice(1)}: ${glossary[found]}`);
  else addMessage("Diesen Begriff habe ich nicht im Glossar.");
}
function help(){ addMessage("Befehle: weiter Â· zurÃ¼ck Â· langsam Â· wiederholen Â· was bedeutet â€¦? Oder nutzen Sie die Buttons."); }

sendBtn.onclick = handleInput;
input.onkeydown = (e)=>{ if (e.key==='Enter') handleInput(); };
btnSpeakLast.onclick = ()=>{ if (lastBot) speak(lastBot); };
btnAutoSpeak.onclick = ()=>{ autoSpeak=!autoSpeak; btnAutoSpeak.textContent = autoSpeak ? 'ğŸ”Š Autoâ€‘Vorlesen: EIN' : 'ğŸ”Š Autoâ€‘Vorlesen: AUS'; };
btnMic.onclick = toggleSTT;

function handleInput(){
  const t = input.value.trim();
  if (!t) return;
  addMessage(t,'user');
  input.value='';
  routeInput(t);
}
function routeInput(text){
  const t = text.toLowerCase();
  if (t.includes('weiter') || t.includes('nÃ¤chste') || t.includes('naechste')) return nextPatient();
  if (t.includes('zurÃ¼ck') || t.includes('zurueck') || t.includes('vorher')) return prevPatient();
  if (t.includes('langsam')) return speakSlow();
  if (t.includes('wiederholen')) return addMessage(lastBot || 'Ich wiederhole gern.', 'bot');
  if (t.startsWith('was bedeutet')) { const term = text.split(/was bedeutet/i)[1] || ''; return explain(term.trim()); }
  if (t.includes('hilfe')) return help();
  addMessage("Ich habe Sie verstanden. Nutzen Sie bitte die Steuer-Buttons oder schreiben Sie: weiter, zurÃ¼ck, langsam, wiederholen, was bedeutet â€¦?");
}

// Start
intro();
</script>
</body>
</html>
