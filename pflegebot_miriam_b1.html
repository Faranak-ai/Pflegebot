<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Pflege-Bot Schwester Miriam (B1)</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    :root { --bg:#f0f4f8; --card:#ffffff; --bot:#0a558c; --user:#14532d; }
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; background: var(--bg); margin:0; padding: 2rem 1rem; }
    .wrap { max-width: 720px; margin: 0 auto; }
    .title { text-align:center; margin-bottom: 1rem; }
    .chatbox { background: var(--card); border-radius: 12px; padding: 1rem; box-shadow: 0 6px 20px rgba(0,0,0,.08); min-height: 320px; max-height: 60vh; overflow: auto; }
    .message { margin: .75rem 0; line-height: 1.45; }
    .bot { color: var(--bot); font-weight: 600; }
    .user { color: var(--user); }
    .bar { display:flex; gap:.5rem; margin-top: .75rem; }
    input[type=text] { flex:1; padding:.75rem .9rem; border-radius: 10px; border: 1px solid #cbd5e1; }
    button { padding:.75rem 1rem; border-radius:10px; border:0; background:#0ea5e9; color:white; font-weight:600; cursor:pointer; }
    button:hover { filter: brightness(.95); }
    .hints { font-size:.9rem; color:#334155; margin-top:.75rem; }
    .pill { display:inline-block; background:#e2e8f0; border-radius:999px; padding:.2rem .6rem; margin:.1rem; }
  </style>
</head>
<body>
<div class="wrap">
  <div class="title">
    <h2>ğŸ‘©â€âš•ï¸ Pflegeâ€‘Bot â€Schwester Miriamâ€œ â€“ Ãœbergabe (B1)</h2>
    <div class="hints">Tipp: Schreibe <span class="pill">weiter</span> Â· <span class="pill">zurÃ¼ck</span> Â· <span class="pill">langsam</span> Â· <span class="pill">wiederholen</span> Â· <span class="pill">hilfe</span> oder <span class="pill">was bedeutet â€¦?</span></div>
  </div>

  <div class="chatbox" id="chat"></div>
  <div class="bar">
    <input id="input" type="text" placeholder="Ihre Nachricht â€¦ (z.â€¯B. â€langsamâ€œ oder â€was bedeutet Drainage?â€œ)" />
    <button id="send">Senden</button>
  </div>
</div>

<script>
// --- Patientendaten (B1) ---
const patients = [
  {
    room: "101",
    name: "Herr Berger",
    fast: "Herr Berger wurde gestern an der HÃ¼fte operiert. Er soll heute zum ersten Mal mit UnterstÃ¼tzung aufstehen â€“ bitte mit Gehhilfe. Thromboseprophylaxe lÃ¤uft weiter. Drainage heute Morgen entfernt. Vitalzeichen unauffÃ¤llig.",
    slow: "Herr Berger hatte gestern eine HÃ¼ftoperation. Heute soll er zum ersten Mal mobilisiert werden, aber nur mit einer Gehhilfe und mit UnterstÃ¼tzung. Er bekommt weiterhin Spritzen gegen Thrombosen. Die Drainage wurde heute frÃ¼h herausgenommen. Seine Vitalwerte sind stabil.",
  },
  {
    room: "102",
    name: "Frau Khatun",
    fast: "Frau Khatun ist in palliativer Betreuung. Schmerzmedikation nach Plan, bitte engmaschig kontrollieren. RegelmÃ¤ÃŸige Mundpflege und Lagerung alle zwei Stunden.",
    slow: "Frau Khatun ist palliativ versorgt. Das bedeutet: Die Erkrankung ist nicht heilbar, und wir lindern Beschwerden. Bitte die Schmerzmittel nach Plan geben und regelmÃ¤ÃŸig kontrollieren. Machen Sie sorgfÃ¤ltige Mundpflege und lagern Sie die Patientin alle zwei Stunden.",
  },
  {
    room: "103",
    name: "Herr Santos",
    fast: "Herr Santos mit Herzinsuffizienz, leichte Ã–deme. Diuretika nach Plan, tÃ¤gliche Gewichts- und FlÃ¼ssigkeitsbilanz. Achten Sie auf Atemnot, Ziel-SÃ¤ttigung â‰¥ 94â€¯%.",
    slow: "Bei Herrn Santos liegt eine HerzschwÃ¤che vor. Er hat leichte Wassereinlagerungen an den Unterschenkeln. Bitte geben Sie die entwÃ¤ssernden Medikamente nach Plan. Erfassen Sie tÃ¤glich sein Gewicht und die FlÃ¼ssigkeitsbilanz. Beobachten Sie ihn auf Atemnot. Ziel ist eine SauerstoffsÃ¤ttigung von mindestens 94â€¯%.",
  },
  // Optional vierter Patient â€“ auskommentieren, falls nicht gewÃ¼nscht
  // {
  //   room: "104",
  //   name: "Frau Novak",
  //   fast: "Frau Novak mit Pneumonie, Tag 2 der Antibiotikatherapie. Atemtraining und Inhalation, SpOâ‚‚-Ziel 92â€“96â€¯% bei Oâ‚‚ Ã¼ber Nasenbrille 2â€¯L/min.",
  //   slow: "Frau Novak hat eine LungenentzÃ¼ndung und erhÃ¤lt seit zwei Tagen Antibiotika. Bitte fÃ¼hren Sie Atemtraining und Inhalationen durch. Wenn nÃ¶tig, geben Sie Sauerstoff Ã¼ber die Nasenbrille mit zwei Litern pro Minute. Ziel ist eine SauerstoffsÃ¤ttigung zwischen 92 und 96â€¯%.",
  // },
];

const glossary = {
  "palliativ": "Palliativ bedeutet: Eine Erkrankung ist nicht heilbar. Ziel ist die Linderung von Beschwerden, vor allem Schmerzen und Atemnot.",
  "thromboseprophylaxe": "MaÃŸnahmen (oft Spritzen), die Blutgerinnsel verhindern sollen.",
  "drainage": "Ein Schlauch, der FlÃ¼ssigkeit aus einer Wunde ableitet; wird entfernt, wenn kaum noch Sekret kommt.",
  "mobilisation": "Geplantes, sicheres Aufstehen und Bewegen der Patientin oder des Patienten.",
  "flÃ¼ssigkeitsbilanz": "GegenÃ¼berstellung von Aufgenommener und Ausgeschiedener FlÃ¼ssigkeit pro Tag.",
  "diuretika": "EntwÃ¤ssernde Medikamente, die die Urinausscheidung erhÃ¶hen.",
  "sÃ¤ttigung": "SauerstoffsÃ¤ttigung im Blut (SpOâ‚‚), gemessen mit dem Pulsoximeter."
};

// --- Chatlogik ---
const chat = document.getElementById('chat');
const input = document.getElementById('input');
const sendBtn = document.getElementById('send');

let current = 0;       // aktueller Patient
let lastBot = "";      // letzte Bot-Nachricht

function addMessage(text, sender='bot') {
  const div = document.createElement('div');
  div.className = 'message ' + sender;
  div.textContent = (sender === 'bot' ? 'ğŸ‘©â€âš•ï¸ Schwester Miriam: ' : 'ğŸ‘¤ ') + text;
  chat.appendChild(div);
  chat.scrollTop = chat.scrollHeight;
  if (sender === 'bot') lastBot = text;
}

function intro() {
  addMessage("Guten Morgen! Ich beginne mit der Ãœbergabe. Schreiben Sie â€weiterâ€œ, um zum nÃ¤chsten Zimmer zu gehen. Schreiben Sie â€langsamâ€œ, wenn ich wiederholen soll. FÃ¼r Begriffe: â€was bedeutet â€¦?â€œ");
  speakFast();
}

function speakFast() {
  const p = patients[current];
  addMessage(`Zimmer ${p.room} â€“ ${p.name}: ${p.fast}`);
}

function speakSlow() {
  const p = patients[current];
  addMessage(`Ich wiederhole langsamer: Zimmer ${p.room} â€“ ${p.name}. ${p.slow}`);
}

function prevPatient() {
  current = (current - 1 + patients.length) % patients.length;
  speakFast();
}

function nextPatient() {
  current = (current + 1) % patients.length;
  speakFast();
}

function explain(term) {
  const key = term.toLowerCase().normalize('NFD').replace(/[^\wÃ¤Ã¶Ã¼ÃŸ]/g,'');
  let found = null;
  for (const k in glossary) {
    const norm = k.toLowerCase().normalize('NFD').replace(/[^\wÃ¤Ã¶Ã¼ÃŸ]/g,'');
    if (key.includes(norm) || norm.includes(key)) { found = k; break; }
  }
  if (found) addMessage(`${found[0].toUpperCase()+found.slice(1)}: ${glossary[found]}`);
  else addMessage("Diesen Begriff habe ich nicht im Glossar. Fragen Sie gern anders oder nennen Sie einen anderen Begriff.");
}

function help() {
  addMessage("Befehle: â€weiterâ€œ (nÃ¤chster Patient) Â· â€zurÃ¼ckâ€œ (vorheriges Zimmer) Â· â€langsamâ€œ (Wiederholung in B1) Â· â€wiederholenâ€œ (letzte Aussage) Â· â€was bedeutet â€¦?â€œ (Begriffe erklÃ¤ren) Â· â€hilfeâ€œ (diese Ãœbersicht).");
}

sendBtn.addEventListener('click', handleInput);
input.addEventListener('keydown', (e) => { if (e.key === 'Enter') handleInput(); });

function handleInput() {
  const text = input.value.trim();
  if (!text) return;
  addMessage(text, 'user');
  input.value='';

  const t = text.toLowerCase();

  // Routing
  if (t.includes('weiter') || t.includes('nÃ¤chste') || t.includes('naechste')) return setTimeout(nextPatient, 400);
  if (t.includes('zurÃ¼ck') || t.includes('zurueck') || t.includes('vorher')) return setTimeout(prevPatient, 400);
  if (t.includes('langsam')) return setTimeout(speakSlow, 400);
  if (t.includes('wiederholen')) return setTimeout(() => addMessage(lastBot || "Ich wiederhole gern, aber mir liegt keine letzte Aussage vor."), 300);
  if (t.startsWith('was bedeutet')) {
    const term = text.split(/was bedeutet/i)[1] || '';
    return setTimeout(() => explain(term.trim()), 400);
  }
  if (t.includes('hilfe') || t.includes('help')) return setTimeout(help, 300);

  // Falls nichts passt:
  setTimeout(() => addMessage("Ich habe Sie verstanden. Sie kÃ¶nnen â€weiterâ€œ, â€langsamâ€œ, â€zurÃ¼ckâ€œ, â€wiederholenâ€œ oder â€was bedeutet â€¦?â€œ schreiben."), 300);
}

// Start
intro();
</script>
</body>
</html>
