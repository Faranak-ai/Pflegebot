<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Pflege-Bot Schwester Miriam (B1) â€“ mit Buttons & Sprache</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    :root { --bg:#f0f4f8; --card:#ffffff; --bot:#0a558c; --user:#14532d; }
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; background: var(--bg); margin:0; padding: 2rem 1rem; }
    .wrap { max-width: 760px; margin: 0 auto; }
    .title { text-align:center; margin-bottom: 1rem; }
    .chatbox { background: var(--card); border-radius: 12px; padding: 1rem; box-shadow: 0 6px 20px rgba(0,0,0,.08); min-height: 320px; max-height: 60vh; overflow: auto; }
    .message { margin: .75rem 0; line-height: 1.45; }
    .bot { color: var(--bot); font-weight: 600; }
    .user { color: var(--user); }
    .bar { display:flex; gap:.5rem; margin-top: .75rem; flex-wrap: wrap; }
    input[type=text] { flex:1; min-width: 240px; padding:.75rem .9rem; border-radius: 10px; border: 1px solid #cbd5e1; }
    button { padding:.6rem .9rem; border-radius:10px; border:0; background:#0ea5e9; color:white; font-weight:600; cursor:pointer; }
    button.secondary { background:#475569; }
    button:hover { filter: brightness(.95); }
    .hints { font-size:.9rem; color:#334155; margin-top:.75rem; }
    .toolbar, .controls, .glossary { display:flex; gap:.5rem; justify-content:center; flex-wrap: wrap; margin-top:.75rem; }
    .note { font-size:.85rem; color:#475569; text-align:center; margin-bottom:.5rem; }
    .controls button { background:#64748b; }
    .glossary button { background:#334155; font-size:.85rem; }
  </style>
</head>
<body>
<div class="wrap">
  <div class="title">
    <h2>ğŸ‘©â€âš•ï¸ Pflegeâ€‘Bot â€Schwester Miriamâ€œ â€“ Ãœbergabe (B1)</h2>
    <div class="hints">Nutzen Sie Eingabe, Sprache oder Buttons.</div>
  </div>

  <div class="toolbar">
    <button id="btnSpeakLast" class="secondary">ğŸ”Š Vorlesen</button>
    <button id="btnAutoSpeak" class="secondary">ğŸ”Š Autoâ€‘Vorlesen: AUS</button>
    <button id="btnMic" class="secondary">ğŸ™ï¸ Spracheingabe: START</button>
  </div>
  <div class="note">Spracheingabe funktioniert am zuverlÃ¤ssigsten in Chrome Ã¼ber HTTPS.</div>

  <div class="chatbox" id="chat"></div>
  <div class="bar">
    <input id="input" type="text" placeholder="Ihre Nachricht â€¦ (z.â€¯B. â€langsamâ€œ oder â€was bedeutet Drainage?â€œ)" />
    <button id="send">Senden</button>
  </div>

  <div class="controls">
    <button onclick="nextPatient()">â¡ï¸ Weiter</button>
    <button onclick="prevPatient()">â¬…ï¸ ZurÃ¼ck</button>
    <button onclick="speakSlow()">ğŸ¢ Langsam</button>
    <button onclick="addMessage(lastBot,'bot')">ğŸ” Wiederholen</button>
    <button onclick="help()">â„¹ï¸ Hilfe</button>
  </div>

  <div class="glossary">
    <button onclick="explain('palliativ')">Palliativ</button>
    <button onclick="explain('Thromboseprophylaxe')">Thromboseprophylaxe</button>
    <button onclick="explain('Drainage')">Drainage</button>
    <button onclick="explain('Mobilisation')">Mobilisation</button>
    <button onclick="explain('FlÃ¼ssigkeitsbilanz')">FlÃ¼ssigkeitsbilanz</button>
    <button onclick="explain('Diuretika')">Diuretika</button>
    <button onclick="explain('SÃ¤ttigung')">SÃ¤ttigung</button>
  </div>
</div>

<script>
// --- Patientendaten (B1) ---
const patients = [
  {
    room: "101",
    name: "Herr Berger",
    fast: "Herr Berger wurde gestern an der HÃ¼fte operiert. Er soll heute zum ersten Mal mit UnterstÃ¼tzung aufstehen â€“ bitte mit Gehhilfe. Thromboseprophylaxe lÃ¤uft weiter. Drainage heute Morgen entfernt. Vitalzeichen unauffÃ¤llig.",
    slow: "Herr Berger hatte gestern eine HÃ¼ftoperation. Heute soll er zum ersten Mal mobilisiert werden, aber nur mit einer Gehhilfe und mit UnterstÃ¼tzung. Er bekommt weiterhin Spritzen gegen Thrombosen. Die Drainage wurde heute frÃ¼h herausgenommen. Seine Vitalwerte sind stabil.",
  },
  {
    room: "102",
    name: "Frau Khatun",
    fast: "Frau Khatun ist in palliativer Betreuung. Schmerzmedikation nach Plan, bitte engmaschig kontrollieren. RegelmÃ¤ÃŸige Mundpflege und Lagerung alle zwei Stunden.",
    slow: "Frau Khatun ist palliativ versorgt. Das bedeutet: Die Erkrankung ist nicht heilbar, und wir lindern Beschwerden. Bitte die Schmerzmittel nach Plan geben und regelmÃ¤ÃŸig kontrollieren. Machen Sie sorgfÃ¤ltige Mundpflege und lagern Sie die Patientin alle zwei Stunden.",
  },
  {
    room: "103",
    name: "Herr Santos",
    fast: "Herr Santos mit Herzinsuffizienz, leichte Ã–deme. Diuretika nach Plan, tÃ¤gliche Gewichts- und FlÃ¼ssigkeitsbilanz. Achten Sie auf Atemnot, Ziel-SÃ¤ttigung â‰¥ 94â€¯%.",
    slow: "Bei Herrn Santos liegt eine HerzschwÃ¤che vor. Er hat leichte Wassereinlagerungen an den Unterschenkeln. Bitte geben Sie die entwÃ¤ssernden Medikamente nach Plan. Erfassen Sie tÃ¤glich sein Gewicht und die FlÃ¼ssigkeitsbilanz. Beobachten Sie ihn auf Atemnot. Ziel ist eine SauerstoffsÃ¤ttigung von mindestens 94â€¯%.",
  },
];

const glossary = {
  "palliativ": "Palliativ bedeutet: Eine Erkrankung ist nicht heilbar. Ziel ist die Linderung von Beschwerden, vor allem Schmerzen und Atemnot.",
  "thromboseprophylaxe": "MaÃŸnahmen (oft Spritzen), die Blutgerinnsel verhindern sollen.",
  "drainage": "Ein Schlauch, der FlÃ¼ssigkeit aus einer Wunde ableitet; wird entfernt, wenn kaum noch Sekret kommt.",
  "mobilisation": "Geplantes, sicheres Aufstehen und Bewegen der Patientin oder des Patienten.",
  "flÃ¼ssigkeitsbilanz": "GegenÃ¼berstellung von aufgenommener und ausgeschiedener FlÃ¼ssigkeit pro Tag.",
  "diuretika": "EntwÃ¤ssernde Medikamente, die die Urinausscheidung erhÃ¶hen.",
  "sÃ¤ttigung": "SauerstoffsÃ¤ttigung im Blut (SpOâ‚‚), gemessen mit dem Pulsoximeter."
};

// --- Chatlogik ---
const chat = document.getElementById('chat');
const input = document.getElementById('input');
const sendBtn = document.getElementById('send');
const btnSpeakLast = document.getElementById('btnSpeakLast');
const btnAutoSpeak = document.getElementById('btnAutoSpeak');
const btnMic = document.getElementById('btnMic');

let current = 0;       // aktueller Patient
let lastBot = "";      // letzte Bot-Nachricht
let autoSpeak = false; // automatische Sprachausgabe

function addMessage(text, sender='bot') {
  const div = document.createElement('div');
  div.className = 'message ' + sender;
  div.textContent = (sender === 'bot' ? 'ğŸ‘©â€âš•ï¸ Schwester Miriam: ' : 'ğŸ‘¤ ') + text;
  chat.appendChild(div);
  chat.scrollTop = chat.scrollHeight;
  if (sender === 'bot') {
    lastBot = text;
    if (autoSpeak) speak(text);
  }
}

function speak(text) {
  try {
    window.speechSynthesis.cancel();
    const u = new SpeechSynthesisUtterance(text);
    u.lang = 'de-DE'; u.rate = 0.98;
    window.speechSynthesis.speak(u);
  } catch (e) { console.error(e); }
}

let recognition=null, recognizing=false;
function initSTT(){
  const SR=window.SpeechRecognition||window.webkitSpeechRecognition;
  if(!SR)return null;
  const rec=new SR(); rec.lang='de-DE';
  rec.onresult=(e)=>{const t=e.results[0][0].transcript;addMessage(t,'user');routeInput(t);};
  rec.onend=()=>{recognizing=false;btnMic.textContent='ğŸ™ï¸ Spracheingabe: START';};
  return rec;
}
function toggleSTT(){
  if(!recognition)recognition=initSTT();
  if(!recognition){alert('Spracheingabe nicht unterstÃ¼tzt. Bitte Chrome nutzen.');return;}
  if(recognizing){recognition.stop();recognizing=false;btnMic.textContent='ğŸ™ï¸ Spracheingabe: START';}
  else{recognition.start();recognizing=true;btnMic.textContent='ğŸ›‘ Spracheingabe: STOP';}
}

function intro(){ addMessage("Guten Morgen! Ich beginne mit der Ãœbergabe. Nutzen Sie Eingabe oder Buttons."); speakFast(); }
function speakFast(){const p=patients[current]; addMessage(`Zimmer ${p.room} â€“ ${p.name}: ${p.fast}`);}
function speakSlow(){const p=patients[current]; addMessage(`Ich wiederhole langsamer: Zimmer ${p.room} â€“ ${p.name}. ${p.slow}`);}
function prevPatient(){current=(current-1+patients.length)%patients.length;speakFast();}
function nextPatient(){current=(current+1)%patients.length;speakFast();}
function explain(term){
  const key=term.toLowerCase().normalize('NFD').replace(/[^\wÃ¤Ã¶Ã¼ÃŸ]/g,'');
  let found=null;
  for(const k in glossary){const norm=k.toLowerCase().normalize('NFD').replace(/[^\wÃ¤Ã¶Ã¼ÃŸ]/g,'');if(key.includes(norm)||norm.includes(key)){found=k;break;}}
  if(found) addMessage(`${found[0].toUpperCase()+found.slice(1)}: ${glossary[found]}`);
  else addMessage("Diesen Begriff habe ich nicht im Glossar.");
}
function help(){addMessage("Befehle: weiter Â· zurÃ¼ck Â· langsam Â· wiederholen Â· was bedeutet â€¦? Oder nutzen Sie die Buttons unten.");}

sendBtn.onclick=handleInput; input.onkeydown=(e)=>{if(e.key==='Enter')handleInput();};
btnSpeakLast.onclick=()=>{if(lastBot) speak(lastBot);};
btnAutoSpeak.onclick=()=>{autoSpeak=!autoSpeak;btnAutoSpeak.textContent=autoSpeak?'ğŸ”Š Autoâ€‘Vorlesen: EIN':'ğŸ”Š Autoâ€‘Vorlesen: AUS';};
btnMic.onclick=toggleSTT;

function handleInput(){const t=input.value.trim();if(!t)return;addMessage(t,'user');input.value='';routeInput(t);}
function routeInput(text){
  const t=text.toLowerCase();
  if(t.includes('weiter')||t.includes('nÃ¤chste')||t.includes('naechste')) return nextPatient();
  if(t.includes('zurÃ¼ck')||t.includes('zurueck')||t.includes('vorher')) return prevPatient();
  if(t.includes('langsam')) return speakSlow();
  if(t.includes('wiederholen')) return addMessage(lastBot||'Ich wiederhole gern.','bot');
  if(t.startsWith('was bedeutet')) return explain(text.split(/was bedeutet/i)[1]||'');
  if(t.includes('hilfe')) return help();
  addMessage("Ich habe Sie verstanden. Nutzen Sie bitte die Steuer-Buttons oder schreiben Sie: weiter, zurÃ¼ck, langsam, wiederholen, was bedeutet â€¦?");
}

// Start
intro();
</script>
</body>
</html>
