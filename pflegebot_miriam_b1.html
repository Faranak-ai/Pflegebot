<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Pflege-Bot Schwester Miriam (B1)</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    :root { --bg:#f0f4f8; --card:#ffffff; --bot:#0a558c; --user:#14532d; }
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; background: var(--bg); margin:0; padding: 2rem 1rem; }
    .wrap { max-width: 720px; margin: 0 auto; }
    .title { text-align:center; margin-bottom: 1rem; }
    .chatbox { background: var(--card); border-radius: 12px; padding: 1rem; box-shadow: 0 6px 20px rgba(0,0,0,.08); min-height: 320px; max-height: 60vh; overflow: auto; }
    .message { margin: .75rem 0; line-height: 1.45; }
    .bot { color: var(--bot); font-weight: 600; }
    .user { color: var(--user); }
    .bar { display:flex; gap:.5rem; margin-top: .75rem; }
    input[type=text] { flex:1; padding:.75rem .9rem; border-radius: 10px; border: 1px solid #cbd5e1; }
    button { padding:.75rem 1rem; border-radius:10px; border:0; background:#0ea5e9; color:white; font-weight:600; cursor:pointer; }
    button:hover { filter: brightness(.95); }
    .hints { font-size:.9rem; color:#334155; margin-top:.75rem; }
    .pill { display:inline-block; background:#e2e8f0; border-radius:999px; padding:.2rem .6rem; margin:.1rem; }
  </style>
</head>
<body>
<div class="wrap">
  <div class="title">
    <h2>👩‍⚕️ Pflege‑Bot „Schwester Miriam“ – Übergabe (B1)</h2>
    <div class="hints">Tipp: Schreibe <span class="pill">weiter</span> · <span class="pill">zurück</span> · <span class="pill">langsam</span> · <span class="pill">wiederholen</span> · <span class="pill">hilfe</span> oder <span class="pill">was bedeutet …?</span></div>
  </div>

  <div class="chatbox" id="chat"></div>
  <div class="bar">
    <input id="input" type="text" placeholder="Ihre Nachricht … (z. B. „langsam“ oder „was bedeutet Drainage?“)" />
    <button id="send">Senden</button>
  </div>
</div>

<script>
// --- Patientendaten (B1) ---
const patients = [
  {
    room: "101",
    name: "Herr Berger",
    fast: "Herr Berger wurde gestern an der Hüfte operiert. Er soll heute zum ersten Mal mit Unterstützung aufstehen – bitte mit Gehhilfe. Thromboseprophylaxe läuft weiter. Drainage heute Morgen entfernt. Vitalzeichen unauffällig.",
    slow: "Herr Berger hatte gestern eine Hüftoperation. Heute soll er zum ersten Mal mobilisiert werden, aber nur mit einer Gehhilfe und mit Unterstützung. Er bekommt weiterhin Spritzen gegen Thrombosen. Die Drainage wurde heute früh herausgenommen. Seine Vitalwerte sind stabil.",
  },
  {
    room: "102",
    name: "Frau Khatun",
    fast: "Frau Khatun ist in palliativer Betreuung. Schmerzmedikation nach Plan, bitte engmaschig kontrollieren. Regelmäßige Mundpflege und Lagerung alle zwei Stunden.",
    slow: "Frau Khatun ist palliativ versorgt. Das bedeutet: Die Erkrankung ist nicht heilbar, und wir lindern Beschwerden. Bitte die Schmerzmittel nach Plan geben und regelmäßig kontrollieren. Machen Sie sorgfältige Mundpflege und lagern Sie die Patientin alle zwei Stunden.",
  },
  {
    room: "103",
    name: "Herr Santos",
    fast: "Herr Santos mit Herzinsuffizienz, leichte Ödeme. Diuretika nach Plan, tägliche Gewichts- und Flüssigkeitsbilanz. Achten Sie auf Atemnot, Ziel-Sättigung ≥ 94 %.",
    slow: "Bei Herrn Santos liegt eine Herzschwäche vor. Er hat leichte Wassereinlagerungen an den Unterschenkeln. Bitte geben Sie die entwässernden Medikamente nach Plan. Erfassen Sie täglich sein Gewicht und die Flüssigkeitsbilanz. Beobachten Sie ihn auf Atemnot. Ziel ist eine Sauerstoffsättigung von mindestens 94 %.",
  },
  // Optional vierter Patient – auskommentieren, falls nicht gewünscht
  // {
  //   room: "104",
  //   name: "Frau Novak",
  //   fast: "Frau Novak mit Pneumonie, Tag 2 der Antibiotikatherapie. Atemtraining und Inhalation, SpO₂-Ziel 92–96 % bei O₂ über Nasenbrille 2 L/min.",
  //   slow: "Frau Novak hat eine Lungenentzündung und erhält seit zwei Tagen Antibiotika. Bitte führen Sie Atemtraining und Inhalationen durch. Wenn nötig, geben Sie Sauerstoff über die Nasenbrille mit zwei Litern pro Minute. Ziel ist eine Sauerstoffsättigung zwischen 92 und 96 %.",
  // },
];

const glossary = {
  "palliativ": "Palliativ bedeutet: Eine Erkrankung ist nicht heilbar. Ziel ist die Linderung von Beschwerden, vor allem Schmerzen und Atemnot.",
  "thromboseprophylaxe": "Maßnahmen (oft Spritzen), die Blutgerinnsel verhindern sollen.",
  "drainage": "Ein Schlauch, der Flüssigkeit aus einer Wunde ableitet; wird entfernt, wenn kaum noch Sekret kommt.",
  "mobilisation": "Geplantes, sicheres Aufstehen und Bewegen der Patientin oder des Patienten.",
  "flüssigkeitsbilanz": "Gegenüberstellung von Aufgenommener und Ausgeschiedener Flüssigkeit pro Tag.",
  "diuretika": "Entwässernde Medikamente, die die Urinausscheidung erhöhen.",
  "sättigung": "Sauerstoffsättigung im Blut (SpO₂), gemessen mit dem Pulsoximeter."
};

// --- Chatlogik ---
const chat = document.getElementById('chat');
const input = document.getElementById('input');
const sendBtn = document.getElementById('send');

let current = 0;       // aktueller Patient
let lastBot = "";      // letzte Bot-Nachricht

function addMessage(text, sender='bot') {
  const div = document.createElement('div');
  div.className = 'message ' + sender;
  div.textContent = (sender === 'bot' ? '👩‍⚕️ Schwester Miriam: ' : '👤 ') + text;
  chat.appendChild(div);
  chat.scrollTop = chat.scrollHeight;
  if (sender === 'bot') lastBot = text;
}

function intro() {
  addMessage("Guten Morgen! Ich beginne mit der Übergabe. Schreiben Sie „weiter“, um zum nächsten Zimmer zu gehen. Schreiben Sie „langsam“, wenn ich wiederholen soll. Für Begriffe: „was bedeutet …?“");
  speakFast();
}

function speakFast() {
  const p = patients[current];
  addMessage(`Zimmer ${p.room} – ${p.name}: ${p.fast}`);
}

function speakSlow() {
  const p = patients[current];
  addMessage(`Ich wiederhole langsamer: Zimmer ${p.room} – ${p.name}. ${p.slow}`);
}

function prevPatient() {
  current = (current - 1 + patients.length) % patients.length;
  speakFast();
}

function nextPatient() {
  current = (current + 1) % patients.length;
  speakFast();
}

function explain(term) {
  const key = term.toLowerCase().normalize('NFD').replace(/[^\wäöüß]/g,'');
  let found = null;
  for (const k in glossary) {
    const norm = k.toLowerCase().normalize('NFD').replace(/[^\wäöüß]/g,'');
    if (key.includes(norm) || norm.includes(key)) { found = k; break; }
  }
  if (found) addMessage(`${found[0].toUpperCase()+found.slice(1)}: ${glossary[found]}`);
  else addMessage("Diesen Begriff habe ich nicht im Glossar. Fragen Sie gern anders oder nennen Sie einen anderen Begriff.");
}

function help() {
  addMessage("Befehle: „weiter“ (nächster Patient) · „zurück“ (vorheriges Zimmer) · „langsam“ (Wiederholung in B1) · „wiederholen“ (letzte Aussage) · „was bedeutet …?“ (Begriffe erklären) · „hilfe“ (diese Übersicht).");
}

sendBtn.addEventListener('click', handleInput);
input.addEventListener('keydown', (e) => { if (e.key === 'Enter') handleInput(); });

function handleInput() {
  const text = input.value.trim();
  if (!text) return;
  addMessage(text, 'user');
  input.value='';

  const t = text.toLowerCase();

  // Routing
  if (t.includes('weiter') || t.includes('nächste') || t.includes('naechste')) return setTimeout(nextPatient, 400);
  if (t.includes('zurück') || t.includes('zurueck') || t.includes('vorher')) return setTimeout(prevPatient, 400);
  if (t.includes('langsam')) return setTimeout(speakSlow, 400);
  if (t.includes('wiederholen')) return setTimeout(() => addMessage(lastBot || "Ich wiederhole gern, aber mir liegt keine letzte Aussage vor."), 300);
  if (t.startsWith('was bedeutet')) {
    const term = text.split(/was bedeutet/i)[1] || '';
    return setTimeout(() => explain(term.trim()), 400);
  }
  if (t.includes('hilfe') || t.includes('help')) return setTimeout(help, 300);

  // Falls nichts passt:
  setTimeout(() => addMessage("Ich habe Sie verstanden. Sie können „weiter“, „langsam“, „zurück“, „wiederholen“ oder „was bedeutet …?“ schreiben."), 300);
}

// Start
intro();
</script>
</body>
</html>
